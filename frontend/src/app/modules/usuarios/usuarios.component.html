<div class="max-w-6xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Gerenciamento de Usuários</h1>
      <p class="text-sm text-gray-600">Crie e administre os acessos da plataforma.</p>
    </div>
    <button
      class="px-5 py-2 rounded-2xl bg-blue-600 text-white text-sm font-semibold shadow hover:bg-blue-700"
      (click)="abrirNovo()"
    >
      Novo usuário
    </button>
  </div>

  <div *ngIf="mensagemSucesso" class="mb-4 p-3 rounded-2xl bg-green-50 text-green-700 text-sm">
    {{ mensagemSucesso }}
  </div>
  <div *ngIf="mensagemErro" class="mb-4 p-3 rounded-2xl bg-red-50 text-red-600 text-sm">
    {{ mensagemErro }}
  </div>

  <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
      <span class="text-sm font-semibold text-gray-700">Usuários cadastrados</span>
      <span class="text-xs text-gray-500">{{ usuarios.length }} usuário(s)</span>
    </div>

    <div *ngIf="carregando" class="p-8 flex items-center justify-center">
      <div class="w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
      <span class="ml-3 text-sm text-gray-600">Carregando usuários...</span>
    </div>

    <div *ngIf="!carregando && usuarios.length === 0" class="p-8 text-center text-sm text-gray-500">
      Nenhum usuário cadastrado até o momento.
    </div>

    <div *ngIf="!carregando && usuarios.length > 0" class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-100">
        <thead class="bg-gray-50 text-xs uppercase text-gray-500">
          <tr>
            <th class="px-6 py-3 text-left">Nome</th>
            <th class="px-6 py-3 text-left">E-mail</th>
            <th class="px-6 py-3 text-left">Perfil</th>
            <th class="px-6 py-3 text-right">Ações</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 text-sm text-gray-700">
          <tr *ngFor="let usuario of usuarios" class="hover:bg-gray-50">
            <td class="px-6 py-3 font-medium">{{ usuario.nome }}</td>
            <td class="px-6 py-3">{{ usuario.usuario }}</td>
            <td class="px-6 py-3">
              <span
                class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs"
                [ngClass]="{
                  'bg-blue-50 text-blue-700': usuario.perfil === 'ADMINISTRADOR',
                  'bg-gray-100 text-gray-700': usuario.perfil === 'USUARIO'
                }"
              >
                <span class="w-2 h-2 rounded-full"
                  [ngClass]="{
                    'bg-blue-500': usuario.perfil === 'ADMINISTRADOR',
                    'bg-gray-500': usuario.perfil === 'USUARIO'
                  }"></span>
                {{ usuario.perfil === 'ADMINISTRADOR' ? 'Administrador' : 'Usuário' }}
              </span>
            </td>
            <td class="px-6 py-3 text-right space-x-2">
              <button class="acao secundario" (click)="editarUsuario(usuario)">Editar</button>
              <button class="acao perigo" (click)="removerUsuario(usuario)">Remover</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="exibindoFormulario" class="mt-8 bg-white rounded-3xl shadow-xl border border-gray-100">
    <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold text-gray-900">{{ editando ? 'Editar usuário' : 'Novo usuário' }}</h2>
        <p class="text-xs text-gray-500">
          Defina nome, e-mail, perfil de acesso e senha para o usuário.
        </p>
      </div>
      <button class="text-sm text-gray-500 hover:text-gray-700" (click)="cancelar()">Cancelar</button>
    </div>

    <form class="px-6 py-6 space-y-6" (ngSubmit)="salvar()" [formGroup]="formulario">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <label class="flex flex-col space-y-2">
          <span class="text-sm font-medium text-gray-700">Nome completo</span>
          <input type="text" class="input" formControlName="nome" placeholder="Nome do usuário" />
          <span class="erro" *ngIf="formulario.get('nome')?.invalid && formulario.get('nome')?.touched">
            Informe um nome com pelo menos 3 caracteres.
          </span>
        </label>

        <label class="flex flex-col space-y-2">
          <span class="text-sm font-medium text-gray-700">E-mail de acesso</span>
          <input type="email" class="input" formControlName="usuario" placeholder="usuario@empresa.com" />
          <span class="erro" *ngIf="formulario.get('usuario')?.invalid && formulario.get('usuario')?.touched">
            Informe um e-mail válido.
          </span>
        </label>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <label class="flex flex-col space-y-2">
          <span class="text-sm font-medium text-gray-700">Perfil de acesso</span>
          <select class="input" formControlName="perfil">
            <option *ngFor="let perfil of perfisDisponiveis" [value]="perfil.valor">{{ perfil.rotulo }}</option>
          </select>
        </label>

        <label class="flex flex-col space-y-2">
          <span class="text-sm font-medium text-gray-700">{{ editando ? 'Nova senha' : 'Senha inicial' }}</span>
          <input type="password" class="input" formControlName="senha" />
          <span class="text-xs text-gray-500">
            {{ editando ? 'Preencha apenas se desejar alterar a senha.' : 'A senha deve ter ao menos 6 caracteres.' }}
          </span>
          <span class="erro" *ngIf="formulario.get('senha')?.invalid && formulario.get('senha')?.touched">
            Informe uma senha com pelo menos 6 caracteres.
          </span>
        </label>
      </div>

      <div class="flex justify-end space-x-3">
        <button type="button" class="px-5 py-2 rounded-2xl border border-gray-200 text-sm" (click)="cancelar()">
          Cancelar
        </button>
        <button
          type="submit"
          class="px-6 py-2 rounded-2xl bg-blue-600 text-white text-sm font-semibold shadow hover:bg-blue-700 disabled:opacity-60"
          [disabled]="salvando"
        >
          {{ salvando ? 'Salvando...' : editando ? 'Salvar alterações' : 'Criar usuário' }}
        </button>
      </div>
    </form>
  </div>
</div>
